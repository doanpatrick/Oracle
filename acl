Tu reÃ§ois cette erreur ORA-24247 : Network Access Control List (ACL) denied parce que ton schÃ©ma Oracle nâ€™a pas les droits dâ€™utiliser UTL_TCP / UTL_SMTP vers ton serveur SMTP.
ğŸ‘‰ Ce nâ€™est pas un problÃ¨me de code, câ€™est un problÃ¨me de droits rÃ©seau dans Oracle.
ğŸ” DÃ©cryptage du message
Copier le code

ORA-24247: Netzwerkzugriff von Access Control-Liste (ACL) abgelehnt
ORA-06512: in "SYS.UTL_TCP"
ORA-06512: in "SYS.UTL_SMTP"
â¡ï¸ Oracle bloque ton appel rÃ©seau car il nâ€™y a aucun ACL permettant Ã  ton utilisateur
(ex : PEBFRISK, SCOTT, APPUSER, etc.)
de faire du SMTP vers ton host.
âœ… SOLUTION : crÃ©er lâ€™ACL correctement
Il faut absolument exÃ©cuter ceci en SYS.
1ï¸âƒ£ Supprimer les ACL anciennes (si elles existent, souvent mal configurÃ©es)
Copier le code
Sql
BEGIN
  FOR r IN (SELECT acl FROM dba_network_acls) LOOP
    DBMS_NETWORK_ACL_ADMIN.DROP_ACL(r.acl);
  END LOOP;
END;
/
ğŸ‘‰ Optionnel si tu veux tout remettre propre.
2ï¸âƒ£ CrÃ©er une ACL valable pour le SMTP
âš ï¸ Remplacer :
smtp.example.com â†’ ton serveur SMTP
PEBFRISK â†’ ton schÃ©ma qui envoie lâ€™email
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.CREATE_ACL(
    acl         => 'smtp_acl.xml',
    description => 'ACL pour SMTP',
    principal   => 'PEBFRISK',
    is_grant    => TRUE,
    privilege   => 'connect'
  );
END;
/
3ï¸âƒ£ Ajouter lâ€™autorisation resolve (indispensable si DNS utilisÃ©)
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(
    acl       => 'smtp_acl.xml',
    principal => 'PEBFRISK',
    is_grant  => TRUE,
    privilege => 'resolve'
  );
END;
/
4ï¸âƒ£ Associer lâ€™ACL au serveur SMTP sur son port
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(
    acl  => 'smtp_acl.xml',
    host => 'smtp.example.com',
    lower_port => 587,
    upper_port => 587
  );
END;
/
5ï¸âƒ£ VÃ©rifier
Copier le code
Sql
SELECT * FROM dba_network_acls;
SELECT * FROM dba_network_acl_privileges;
ğŸŸ¢ Ensuite, ton test UTL_SMTP fonctionnera.
âš ï¸ Attention spÃ©ciale port 587
Selon ton serveur SMTP (Gmail, Office365, OVH) :
â¡ï¸ le port 587 nÃ©cessite STARTTLS, que Oracle ne supporte pas.
Si tu vois ensuite :
Copier le code

ORA-29278: 530 Must issue STARTTLS
Alors il faudra un SMTP relay interne (Postfix/Exchange).
ğŸ“Œ Pour finaliser
Dis-moi juste :
1. Quel est ton serveur SMTP ?
(Office365, Gmail, Exchange interne, OVH, autreâ€¦)
2. Quel est le schÃ©ma Oracle qui exÃ©cute PEBFRISK_EMAIL_SEND_TEST ?
Je te gÃ©nÃ¨re la commande ACL exacte et 100% compatible avec ton contexte.












Voici toutes les commandes Oracle complÃ¨tes pour :
âœ… Lister les ACL existantes
âœ… Voir les privilÃ¨ges
âœ… CrÃ©er une ACL
âœ… Modifier une ACL
âœ… Supprimer une ACL
âœ… Assigner un host / port Ã  une ACL
â¡ï¸ Tout ce quâ€™il faut pour UTL_SMTP, UTL_HTTP, UTL_TCP, etc.
âš ï¸ Toutes ces commandes doivent Ãªtre exÃ©cutÃ©es en SYS.
ğŸŸ¦ 1. VÃ©rifier les ACL existantes
âœ”ï¸ Lister les ACL
Copier le code
Sql
SELECT acl, host, lower_port, upper_port
FROM dba_network_acls
ORDER BY host;
âœ”ï¸ Lister les privilÃ¨ges
Copier le code
Sql
SELECT acl,
       principal,
       privilege,
       is_grant
FROM dba_network_acl_privileges
ORDER BY acl, principal;
âœ”ï¸ Voir si un host a une ACL associÃ©e
Copier le code
Sql
SELECT *
FROM dba_network_acls
WHERE host = 'smtp.example.com';
ğŸŸ© 2. CrÃ©er une ACL
Ex. pour autoriser lâ€™utilisateur APPUSER Ã  accÃ©der au serveur SMTP :
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.CREATE_ACL(
    acl         => 'smtp_acl.xml',
    description => 'ACL SMTP',
    principal   => 'APPUSER',
    is_grant    => TRUE,
    privilege   => 'connect'
  );
END;
/
Optionnel mais trÃ¨s important (DNS, rÃ©solutions IP) :
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(
    acl       => 'smtp_acl.xml',
    principal => 'APPUSER',
    is_grant  => TRUE,
    privilege => 'resolve'
  );
END;
/
Puis associer Ã  un serveur et un port :
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(
    acl        => 'smtp_acl.xml',
    host       => 'smtp.example.com',
    lower_port => 587,
    upper_port => 587
  );
END;
/
ğŸŸ§ 3. Modifier une ACL existante
âœ”ï¸ Ajouter un utilisateur
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(
    acl       => 'smtp_acl.xml',
    principal => 'NEWUSER',
    is_grant  => TRUE,
    privilege => 'connect'
  );
END;
/
âœ”ï¸ Ajouter/retirer une permission
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(
    acl       => 'smtp_acl.xml',
    principal => 'APPUSER',
    is_grant  => FALSE,
    privilege => 'connect'
  );
END;
/
âœ”ï¸ Changer l'association host/port
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.UNASSIGN_ACL(
    host       => 'smtp.example.com',
    lower_port => 587
  );
END;
/
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(
    acl        => 'smtp_acl.xml',
    host       => 'smtp2.example.com',
    lower_port => 25,
    upper_port => 25
  );
END;
/
ğŸŸ¥ 4. Supprimer une ACL
Il faut dâ€™abord dÃ©sassigner lâ€™ACL.
âœ”ï¸ DÃ©sassigner :
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.UNASSIGN_ACL(
    host => 'smtp.example.com'
  );
END;
/
âœ”ï¸ Supprimer lâ€™ACL :
Copier le code
Sql
BEGIN
  DBMS_NETWORK_ACL_ADMIN.DROP_ACL(
    acl => 'smtp_acl.xml'
  );
END;
/
ğŸ”µ 5. Supprimer toutes les ACL (rÃ©initialisation complÃ¨te)
Copier le code
Sql
BEGIN
  FOR r IN (SELECT acl FROM dba_network_acls) LOOP
    DBMS_NETWORK_ACL_ADMIN.DROP_ACL(r.acl);
  END LOOP;
END;
/
âš ï¸ Ã€ utiliser seulement si tu veux repartir de zÃ©ro.
ğŸ” 6. VÃ©rifier aprÃ¨s modification
Copier le code
Sql
SELECT * FROM dba_network_acls;
SELECT * FROM dba_network_acl_privileges;
ğŸŸ£ 7. VÃ©rifier que lâ€™ACL est prise en compte (utile pour envoyer des mails)
Copier le code
Sql
SELECT network_acl_admin.check_privilege(
         username => 'APPUSER',
         privilege => 'connect',
         host => 'smtp.example.com',
         port => 587
       )
FROM dual;
RÃ©sultat attendu : GRANTED
ğŸ‘‰ Si tu veux, donne-moi :
âœ”ï¸ Le nom de ton schÃ©ma Oracle
âœ”ï¸ Le serveur SMTP + port
Et je te gÃ©nÃ¨re la commande ACL exacte prÃªte Ã  coller dans SQL*Plus pour envoyer des mails via UTL_SMTP.